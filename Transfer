from fastapi import FastAPI, Request
from fastapi.middleware.cors import CORSMiddleware
from langchain_core.messages import SystemMessage, HumanMessage
from WiproLLM import WiproChatModel  # or your custom client
import os

app = FastAPI()

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_methods=["*"],
    allow_headers=["*"],
)

client = ...  # Wipro client setup
chat = WiproChatModel(client=client, model_name="gpt-4o-mini")

@app.post("/agent")
async def generate_tagline(request: Request):
    data = await request.json()
    product = data.get("product", "")
    description = data.get("description", "")

    prompt = f"""
    You are a branding expert. 
    Generate a catchy marketing tagline for a product called "{product}".
    The product is described as: {description}.
    Keep the tagline short and creative.
    """

    messages = [
        SystemMessage(content="You are a helpful branding assistant."),
        HumanMessage(content=prompt)
    ]

    try:
        response = chat.invoke(messages)
        return {"response": response.content}
    except Exception as e:
        return {"response": f"Agent Error: {str(e)}"}
