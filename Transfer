from fastapi import FastAPI
from copilotkit.integrations.fastapi import add_fastapi_endpoint
from copilotkit import CopilotKitRemoteEndpoint

# === YOUR SDK code integration ===
from your_sdk import APIClient, Auth, InfoChatModel, SystemMessage, HumanMessage

def my_agent_handler(messages):
    client = APIClient()
    auth = Auth(client)
    auth.login("username", "pass")

    chat = InfoChatModel(client=client, model_name="gpt-40-mini")

    formatted = [
        SystemMessage(m["content"]) if m["role"] == "system"
        else HumanMessage(m["content"]) for m in messages
    ]

    response = chat.invoke(formatted)
    return response.content

sdk = CopilotKitRemoteEndpoint(
    agents=[{"name": "custom", "handler": my_agent_handler}],
    actions=[],
)

app = FastAPI()
add_fastapi_endpoint(app, sdk, "/copilotkit_remote")
